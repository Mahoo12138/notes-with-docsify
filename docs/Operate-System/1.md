## 什么是操作系统？

操作系统是计算机硬件和应用之间的一层软件，方便我们操作计算机的硬件。

具体管理哪些硬件呢？

CPU 管理，内存管理，终端管理，磁盘管理，文件管理，网络管理，电源管理，多核管理……

## 操作系统， 我们要学什么?  

学习操作系统可以有很多层次：

1. 从应用软件出发“探到操作系统” 集中在使用计算机的接口上：集中在使用计算机的接口上，如使用显示器： `printf`； 使用CPU： `fork`， 使用文件： `open`、 `read`…
2. 从应用软件出发“进入操作系统”：一段文字是如何写到磁盘上的…
3. 从硬件出发“设计并实现操作系统”：给你一个板子， 配一个操作系统

本次学习的课程目标是，**能改操作系统**：

+ 能理解真实操作系统的运转  
+ `printf(“hello”);`到底怎么回事  
+ 能在真实的基本操作系统上动手实践 

## 基础知识

由于是方便自己学习和理解的笔记，所以不会使用很术语的语句来藐视。

### 实模式与保护模式（8086为例）

#### 实模式

实模式出现于早期8088CPU时期。当时由于CPU的性能有限，一共只有20位地址线（所以地址空间只有1MB），以及8个16位的通用寄存器，以及4个16位的段寄存器。所以为了能够通过这些16位的寄存器去构成20位的主存地址，必须采取一种特殊的方式。当某个指令想要访问某个内存地址时，它通常需要用下面的这种格式来表示：

```assembly
段基址:段偏移量
```

> 段基址，它的值是由**段寄存器**提供的(一般来说，段寄存器有6种，分别为 cs，ds，ss，es，fs，gs；
>
> 段内偏移量，代表你要访问的这个内存地址距离这个段基址的偏移。由通用寄存器来提供的，所以也是16位。CPU把段寄存器所提供的段基址先向左移4位。这样就变成了一个 20 位的值，然后再与段偏移量相加。

由此可见，实模式的"实"更多地体现在其地址是真实的物理地址。

CPU复位（reset）或加电（power on）的时候就是**以实模式启动**，在这个时候处理器以实模式工作，不能实现权限分级，也不能访问 20 位以上的地址线，也就是只能访问 1M 内存。之后一般就加载操作系统模块，进入**保护模式**。

#### 保护模式

20位的**段基址:段偏移量**类型的地址，就是物理地址，物理地址对程序员是可见的。这就带来一些问题：

+ 无法支持多任务；
+ 程序的安全性无法得到保证；